# 节流（throttle）

节流策略（throttle），是指

**减少一段时间内某事件的处触发频率**

在等待的单位时间过程中不会触发事件

降低计算频率，减少CPU损耗

比如：CS射击时子弹的间隔，在间隔时间内的点击会被忽略





## 使用场景

- 鼠标连续不断的点击时，

  点击事件只在单位时间内触发一次

- 懒加载时计算滚动条位置

  不必每次滑动都触发监听事件，







## 节流阀

**操作执行前先判断节流阀是否为空**

**如果节流阀为空，可以进行下次操作**

**如果节流阀不为空，不能进行下次操作**

**当前操作执行完后必须将节流阀重置为空**

比如：火车卫生间有人提示灯，红灯为有人，绿灯为无人

提示灯开始为红，

有人进去灯变红，不能再进人

等人出来后灯重置变绿，又可以再进人

需要判断是灯否为绿，才能知道是否可以进人





## 实例

跟随鼠标移动的图片

```js
$(function(){
   $(document).on('mousemove', function(e){
     $('img').css({
       left: e.pageX + "px",
       top: e.pageY + "px",
     });
   })
})
```

因为页面监听鼠标移动事件，每次鼠标移动就会触发事件

容易增加CPU计算

通过节流优化代码

```js
$(function(){
  // 预定节流阀，设为空
  var flag = null;
  
  $(document).on('mousemove', function(e){
    // 判断节流阀是否为空
    if(flag){return}
    // 设定节流阀
    flag = setTimeout(function(){
      $('img').css({
        left: e.pageX + "px",
        top: e.pageY + "px",
      });
      // 操作完成，重置节流阀，设为空
      flag = null
    },10)

   })
})
```





防抖：保证会被频繁触发的事件最终只会执行最后一次

节流：控制会被频繁触发的事件的触发频率