# 身份认证

身份认证/身份验证/鉴权（Authentication）是指

完成对用户身份的确认的手段

常用于：

- 手机验证码登陆
- 邮箱登陆
- 二维码登陆





## 不同开发模式的身份认证

- **服务器端渲染**的开发模式

  推荐 **Session认证机制**

- **前后端分离**的开发模式

  推荐 **JWT认证机制**





## Cookie

### HTTP协议的无状态性

HTTP协议的无状态性是指

客户端的每次HTTP请求都是**独立**的，

连续多个请求之间没有直接关系，

服务器不会主动保留每次请求的状态

类似：

超市收银员不可能记住每次结账的客人

---

### Cookie在身份认证中的作用

在互联网中的的身份认证方式，叫做 **Cookie**

通过Cookie可以打破HTTP的无状态限制

比如：

客人可以主动出示VIP卡

超市收银员不可能记住每次结账的客人的脸，但识别用户的出示的会员卡

![](https://pbs.twimg.com/media/E3v5JEnUcAE0Sh2?format=jpg&name=medium)

客户端第一次请求服务器时，

服务器会通过**响应头**的形式，给客户端发送一个身份验证的Cookie

客户端会自动将Cookie保存在浏览器

在此之，客户端每次访问该服务器是，浏览器会自动将身份认证的Cookie

通过**请求头**的形式发送给服务器，服务器可借此验证客户端用户身份

---

### Cookie含义

**存储在浏览器中的一段不超过 4KB的字符串**

是Name和Vlaue的健值对形式，

由控制Cookie有效期、安全性、使用范围的可选属性组成

可通过 开发者工具的application面板中检查

![](https://pbs.twimg.com/media/E3v5FpTVIAIldIQ?format=jpg&name=4096x4096)

![](https://pbs.twimg.com/media/E3v5GlRVUAI4Ksr?format=jpg&name=large)

特点：

- **域名独立**

  不同域名下的Cookie各自独立，不能互相访问

  （baidu域名下的Cookie不能访问twitter域名的Cookie）

- **自动发送**

- **有效时限**

  每次客户端发起请求时，

  会自动把当前域名下未过期的所有Cookie发送到服务器，进行身份验证

- **4KB限制**

---

### Cookie不具有安全性

Cookie是存储在浏览器中的，

且浏览器提供读写Cookie的API

所以Cookie容易被伪造，不具有安全性

所以不建议服务器通过Cookie将重要的隐私内容发送给浏览器

**千万不能用Cookie存储隐私数据**

比如：

仅通过出示一张卡片辨别VIP会员身份不安全

因为可以伪造VIP卡片





## Session认证机制

### 提高身份认证的安全性

比如：

为防止伪造VIP卡片

收银员需要通过刷卡来认证身份

只有出示**会员卡 + 并且刷卡确认**才可享受VIP打折

这也是Session认证机制

Cookie：仅出示VIP卡

Session：出示VIP + 刷卡认证

---

### Session工作原理

![](https://pbs.twimg.com/media/E3v8t-CVIAAxXWJ?format=jpg&name=medium)

### 使用实例

详见 笔记[Express](https://github.com/BlaxBerry/StudyNotes/blob/master/Node.js/Express.md)

---

### Session的局限性

Session认证机制需要配合Cookie才能实现

由于Cookie默认不支持跨域，

所以涉及到前端跨域请求时，要做特别多的配置

很麻烦







##  JWT认证机制

当前端请求非跨域时，推荐使用Session身份认证机制

若前端请求涉及跨域时不推荐Session，而是推荐使用 JWT认证机制

JWT（JSON Web Token）是主流的**跨域认证解决方案**

---

### JWT工作原理

![](https://pbs.twimg.com/media/E3w6jKuVUAki6Id?format=jpg&name=medium)

服务端将用户信息加密为Token字符串

然后保存在用户浏览器的LocalStorage中

客户端再次访问服务器时将Token发给服务器

服务器通过还原Token字符串来认证身份

---

### JWT组成

JWT由三部分组成：

三者用 . 隔开

Header.Payload.Signature

- Header 头部
- **Payload** 有效荷载
- Signature 签名

其中Payload部分是用户信息加密后形成的字符串

Header和Signature部分是安全性相关内容，防止Payload被破解

---

### 使用实例

详见 笔记[Express](https://github.com/BlaxBerry/StudyNotes/blob/master/Node.js/Express.md)

---

### 